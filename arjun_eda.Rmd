---
title: "Group Project EDA"
author: "Arjun Venkatesh"
date: "2022-08-09"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE}
library(fpp)
library(tseries)
library(ggplot2)
library(forecast)
library(TSstudio)
library(MLmetrics)
library(vars)
library(dplyr)
```

## Importing Data

Import raw data. Selecting data for all providers and airlines. Data is by month by provider, so need to aggregate by month.

```{r cars}
data <- read.csv('Airline_Delay_Cause.csv')
data[is.na(data)] <- 0

data$date <- as.Date(paste(data$year,'-',data$month,'-','01', sep = ''))


flights <- data %>% group_by(date) %>%
  summarise(flights = sum(arr_flights), delays = sum(arr_del15), carrier = sum(carrier_ct),
            weather = sum(weather_ct), nas = sum(nas_ct), security = sum(security_ct), 
            late_aircraft = sum(late_aircraft_ct), late_aircraft = sum(late_aircraft_ct),
            cancellation = sum(arr_cancelled), diversions = sum(arr_diverted))

flights = subset(flights, select = -c(date))

flights_ts <- ts(flights, start = c(2003,6), frequency = 12)
total_flights <- flights_ts[,1]
total_flights_trunc <- ts(flights_ts[1:202,1], start = c(2003,6), frequency = 12)
total_delays_trunc <- ts(flights_ts[1:202,2], start = c(2003,6), frequency = 12)

```

## EDA

Plot our main time series

```{r pressure, echo=FALSE}
tsdisplay(total_flights)
tsdisplay(total_delays)

tsdisplay(total_flights_trunc)

total_flights_trunc
```

Looking at the ACF and PACF we can see that this is a non-stationary model with both trend and seasonality. Also we can conclude it is an AR model primarily as the ACF decays and PACF drops. Interestingly, the trend is downward and the seanolity is multiplicative, so we may need to apply a box cox transformation. Also there is a clear shock at time 2020,1 where flights dropped fof dramatically.

## Basic Models

Start off with some of the simpler models. Likely to look pretty bad because of the shock for covid. Will try it out arima and ets. I may train the model 

```{r}
auto.arima(total_flights_trunc)

```